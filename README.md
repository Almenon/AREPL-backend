# AREPL-backend [![Build Status](https://travis-ci.org/Almenon/AREPL-backend.svg?branch=master)](https://travis-ci.org/Almenon/AREPL) [![Build status](https://ci.appveyor.com/api/projects/status/24o0d29l7ci9bif3?svg=true)](https://ci.appveyor.com/project/Almenon/arepl-backend)

JS interface to python evaluator for AREPL.

Evaluates python code and sends back the user variables and/or any errors.

Although it is meant for AREPL, it is not dependent upon AREPL and can be used by any project.

**Important Note**: this should ONLY be used to execute trusted code.  It does not have any security features whatsoever.

## Installation

> npm install [arepl-backend](https://www.npmjs.com/package/arepl-backend)

must have python 3

## Usage

see <https://github.com/Almenon/AREPL/blob/master/src/app.js> for example useage. 

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [constructor](#constructor)
-   [evaling](#evaling)
-   [running](#running)
-   [execCode](#execcode)
-   [sendStdin](#sendstdin)
-   [restart](#restart)
-   [stop](#stop)
-   [startPython](#startpython)
-   [onResult](#onresult)
-   [onPrint](#onprint)
-   [handleResult](#handleresult)
-   [checkSyntax](#checksyntax)
-   [formatPythonException](#formatpythonexception)

### constructor

starts pythonEvaluator.py

**Parameters**

-   `pythonPath` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** the path to run python. By default evaluator uses 'python' if on windows or else 'python3'. (optional, default `null`)
-   `pythonOptions` **\[[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)]** see <https://docs.python.org/3/using/cmdline.html#miscellaneous-options>. (optional, default `['-u']`)

### evaling

whether python is busy executing inputted code

### running

whether python backend is on/off

### execCode

does not do anything if program is currently evaling code

**Parameters**

-   `code` **{evalCode: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)}** 

### sendStdin

**Parameters**

-   `message` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

### restart

kills python process and restarts.  Force-kills if necessary after 50ms.
After process restarts the callback passed in is invoked

**Parameters**

-   `callback`   (optional, default `()=>{}`)

### stop

kills python process.  force-kills if necessary after 50ms.
you can check PythonEvaluator.running to see if process is dead yet

### startPython

starts pythonEvaluator.py. Will NOT WORK with python 2

### onResult

Overwrite this with your own handler.
is called when program fails or completes

**Parameters**

-   `foo` **{ERROR: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), userVariables: [Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object), execTime: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number), totalPyTime: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number), totalTime: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)}** 

### onPrint

Overwrite this with your own handler.
Is called when program prints

**Parameters**

-   `foo` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

### handleResult

handles pyshell results and calls onResult / onPrint

**Parameters**

-   `results` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

### checkSyntax

checks syntax without executing code

**Parameters**

-   `code` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)** rejects w/ stderr if syntax failure

### formatPythonException

gets rid of unnecessary exception data, among other things

**Parameters**

-   `err` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

**Examples**

```javascript
err:
"Traceback (most recent call last):
  File "pythonEvaluator.py", line 26, in <module>
	exec(data['evalCode'], evalLocals)
  line 4, in <module>
NameError: name 'y' is not defined"
```

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
